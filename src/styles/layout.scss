// ============================================================================
// LAYOUT COMPONENTS STYLES - OTIMIZADO COM TAILWIND + OVERFLOW FIX
// ============================================================================

// ============================================================================
// VARIÁVEIS E CONFIGURAÇÕES
// ============================================================================
:root {
  --transition-base: 300ms ease-in-out;
  --blur-backdrop: blur(8px);
}

// ============================================================================
// MIXINS OTIMIZADOS COM TAILWIND
// ============================================================================
@mixin smooth-transition($properties: all, $duration: 300ms) {
  transition: #{$properties} #{$duration} ease-in-out;
}

@mixin interactive-base {
  @include smooth-transition;
  @apply cursor-pointer outline-none;

  &:hover {
    @apply opacity-80;
  }
  &:focus {
    @apply outline-none;
  }
  &:disabled {
    @apply opacity-50 cursor-not-allowed pointer-events-none;
  }
}

@mixin backdrop-blur {
  @apply backdrop-blur-sm;
}

@mixin surface-styles {
  background-color: rgb(var(--color-surface));
  border-color: rgb(var(--color-border));
}

@mixin text-variants {
  color: rgb(var(--color-text));

  &--primary {
    color: rgb(var(--color-primary));
  }
  &--secondary {
    color: rgb(var(--color-secondary));
  }
}

@mixin animated-underline($color: --color-primary) {
  @apply relative;

  &::after {
    content: '';
    @apply absolute bottom-0 left-0 w-0 h-0.5;
    background-color: rgb(var(#{$color}));
    @include smooth-transition(width);
  }

  &--active::after,
  &:hover::after {
    @apply w-full;
  }

  &:hover:not(&--active)::after {
    @apply opacity-50;
  }
}

// Novo mixin para centralizar e alinhar conteúdo
@mixin content-container {
  @apply mx-auto w-full px-4 md:px-6 max-w-7xl;
}

// ============================================================================
// COMPONENTES BASE
// ============================================================================

// HEADER COMPONENT - COM CORREÇÕES DE OVERFLOW
.header {
  @include smooth-transition;
  @apply w-full z-50;
  // CORREÇÃO: Prevenir overflow horizontal no header principal
  @apply overflow-x-hidden;

  // Variantes de estilo
  &--default,
  &--sticky {
    @include surface-styles;
    @apply border-b;
  }

  &--minimal,
  &--transparent {
    @apply bg-transparent border-none;
  }

  &--sticky,
  &--transparent {
    @include backdrop-blur;
  }

  &--fixed {
    @apply fixed top-0;
  }

  &--scrolled {
    @apply shadow-sm;
  }

  // Estados
  &--disabled {
    @apply opacity-50 pointer-events-none;
  }

  // Layout principal - PADDING E ALINHAMENTO CONSISTENTE + OVERFLOW FIX
  &__nav {
    @include content-container;
    @apply py-3 md:py-4 flex items-center justify-between;
    // CORREÇÃO: Prevenir overflow no container principal
    @apply overflow-x-hidden min-w-0;
  }

  &__logo {
    @include interactive-base;
    @include text-variants;
    @apply text-xl font-bold;
    // CORREÇÃO: Prevenir quebra do logo
    @apply flex-shrink-0;
  }

  // Desktop navigation
  &__nav-desktop {
    @apply hidden md:flex items-center space-x-8;
    // CORREÇÃO: Permitir que a navegação se ajuste
    @apply flex-shrink min-w-0;
  }

  &__nav-link {
    @include interactive-base;
    @include animated-underline;
    @include text-variants;
    @apply pb-1;
    // CORREÇÃO: Prevenir quebra dos links
    @apply flex-shrink-0 whitespace-nowrap;

    &--active {
      @apply font-medium;
      color: rgb(var(--color-primary));
    }
  }

  // Controls section
  &__controls {
    @apply flex items-center space-x-2;
    // CORREÇÃO: Manter controles sempre visíveis
    @apply flex-shrink-0;
  }

  &__theme-toggle,
  &__mobile-toggle {
    @include interactive-base;
    @include text-variants;
    @apply p-2;
    // CORREÇÃO: Garantir tamanho fixo dos botões
    @apply flex-shrink-0;
  }

  &__mobile-toggle {
    @apply md:hidden;
  }

  // Mobile menu - CORREÇÕES PRINCIPAIS PARA OVERFLOW
  &__mobile-menu {
    @apply md:hidden border-t;
    border-color: rgb(var(--color-border));
    animation: slideDown 200ms ease-out;

    // CORREÇÃO CRÍTICA: Controle total de overflow
    @apply w-full max-w-full overflow-x-hidden;
    // CORREÇÃO: Posicionamento seguro
    @apply relative left-0 right-0;
    // CORREÇÃO: Garantir que não ultrapasse a viewport
    width: 100vw;
    margin-left: calc(-50vw + 50%);
    margin-right: calc(-50vw + 50%);
  }

  &__mobile-nav {
    @include content-container;
    @apply py-2 space-y-1;
    // CORREÇÃO: Container interno seguro
    @apply w-full max-w-full overflow-hidden;
    // CORREÇÃO: Resetar margens negativas do menu pai
    @apply mx-auto;
    max-width: 100%;
  }

  &__mobile-link {
    @include interactive-base;
    @include smooth-transition;
    @apply block w-full text-left py-2 px-3 rounded relative;
    // CORREÇÃO: Todas as declarações CSS ANTES das regras aninhadas
    @apply overflow-hidden text-ellipsis max-w-full;
    word-wrap: break-word;
    hyphens: auto;
    color: rgb(var(--color-text)); // Aplicar cor base diretamente

    &::before {
      content: '';
      @apply absolute left-0 top-0 w-0 h-full;
      background-color: rgb(var(--color-primary));
      @include smooth-transition(width);
    }

    &--active {
      background-color: rgb(var(--color-primary) / 0.1);

      &::before {
        @apply w-1;
      }
    }

    &:hover:not(&--active) {
      background-color: rgb(var(--color-secondary) / 0.05);
    }

    // Variantes de cor como regras aninhadas separadas
    &--primary {
      color: rgb(var(--color-primary));
    }
    &--secondary {
      color: rgb(var(--color-secondary));
    }
  }
}

// FOOTER COMPONENT
.footer {
  @include smooth-transition;
  @apply mt-auto;

  // Variantes
  &--default,
  &--extended {
    @include surface-styles;
    @apply border-t;
  }

  &--minimal {
    @apply bg-transparent border-none;
  }

  &--sticky {
    @apply sticky bottom-0;
  }

  // PADDING E ALINHAMENTO CONSISTENTE
  &__content {
    @include content-container;
    @apply py-6;
  }

  &--compact &__content {
    @apply py-4;
  }

  &__wrapper {
    @apply flex flex-col sm:flex-row justify-between items-center space-y-4 sm:space-y-0;
  }

  &__links {
    @apply flex space-x-6 text-sm;

    &--extended {
      @apply flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-6;
    }
  }

  &__link {
    @include interactive-base;
    @include text-variants;
    @apply text-sm;

    &--external::after {
      content: ' ↗';
      @apply text-xs opacity-60;
    }
  }

  &__social {
    @apply flex items-center space-x-4 mt-4 sm:mt-0;

    &-link {
      @include interactive-base;
      @include text-variants;
      @apply text-lg;
    }
  }

  &__copyright {
    @include text-variants;
    @apply text-sm;
  }

  // Layout estendido
  &--extended {
    .footer__wrapper {
      @apply flex-col space-y-6;
    }

    .footer__main {
      @apply flex flex-col sm:flex-row justify-between items-start w-full space-y-4 sm:space-y-0;
    }

    .footer__bottom {
      @apply flex flex-col sm:flex-row justify-between items-center w-full pt-4 space-y-2 sm:space-y-0;
      border-top: 1px solid rgb(var(--color-border));
    }
  }
}

// MAIN LAYOUT
.main-layout {
  @apply min-h-screen flex flex-col;
  background-color: rgb(var(--color-background));
  color: rgb(var(--color-text));
  transition: var(--transition-theme);
  // CORREÇÃO: Prevenir overflow horizontal no layout principal
  @apply overflow-x-hidden;

  // Espaçamento responsivo
  &--compact {
    @apply space-y-24 sm:space-y-24;
  }

  &--normal {
    @apply space-y-24 sm:space-y-32;
  }

  &--relaxed {
    @apply space-y-24 sm:space-y-40;
  }

  // PADDING E ALINHAMENTO CONSISTENTE
  &__content {
    @apply flex-grow pb-8;
    // CORREÇÃO: Garantir que o conteúdo não ultrapasse
    @apply w-full max-w-full overflow-x-hidden;
  }

  &__container {
    @include content-container;
    // CORREÇÃO: Container seguro
    @apply max-w-full overflow-x-hidden;
  }
}

// CONTAINERS - PADDING CONSISTENTE + OVERFLOW PROTECTION
.layout-container {
  @include content-container;
  // CORREÇÃO: Proteção global contra overflow
  @apply max-w-full overflow-x-hidden;
}

// ============================================================================
// CORREÇÕES ESPECÍFICAS PARA CHROME
// ============================================================================

// Correção específica para webkit (Chrome/Safari)
@supports (-webkit-backdrop-filter: blur(8px)) {
  .header__mobile-menu {
    // Força recálculo do layout no Chrome
    transform: translateZ(0);
    will-change: transform;
  }
}

// Proteção adicional para viewports muito pequenas
@media (max-width: 320px) {
  .header__mobile-nav {
    @apply px-2; // Reduz padding em telas muito pequenas
  }

  .header__mobile-link {
    @apply px-2 text-sm; // Ajusta padding e tamanho da fonte
  }
}

// ============================================================================
// ANIMAÇÕES
// ============================================================================
@keyframes slideDown {
  from {
    @apply opacity-0;
    transform: translateY(-0.625rem);
  }
  to {
    @apply opacity-100;
    transform: translateY(0);
  }
}

// CORREÇÃO: Animação mais suave e sem overflow
@keyframes slideDownSafe {
  from {
    @apply opacity-0;
    transform: translateY(-10px);
    max-height: 0;
    overflow: hidden;
  }
  to {
    @apply opacity-100;
    transform: translateY(0);
    max-height: 100vh;
    overflow: visible;
  }
}
