// ============================================================================
// SETTINGS - Variables and Design Tokens
// ============================================================================

// Card-specific design tokens
$card-border-radius: 1rem;
$card-image-height: 12rem;
$card-image-height-compact: 9rem;
$card-image-height-large: 16rem;
$card-content-padding: 1.5rem;
$card-content-padding-compact: 1rem;
$card-content-padding-large: 2rem;

// Animation settings
$card-transition-duration: 0.3s;
$image-transition-duration: 0.4s;
$card-easing: cubic-bezier(0.4, 0, 0.2, 1);

// Shimmer animation settings
$shimmer-duration: 2s;
$pulse-duration: 2s;

// Progress colors
$progress-color: rgb(255, 165, 0);
$progress-color-light: rgba(255, 165, 0, 0.1);
$progress-color-medium: rgba(255, 165, 0, 0.3);
$progress-color-strong: rgba(255, 165, 0, 0.9);

// ============================================================================
// BASE - Custom Properties (sem @layer)
// ============================================================================

.project-card {
  --card-bg: rgb(var(--color-surface));
  --card-border: rgb(var(--color-border));
  --card-text: rgb(var(--color-text));
  --card-text-muted: rgb(var(--color-text) / 0.7);
  --card-text-subtle: rgb(var(--color-text) / 0.6);
  --card-primary: rgb(var(--color-primary));
  --card-accent: rgb(var(--color-accent));
  --card-focus-ring: rgb(var(--color-background));
  --card-focus-offset: rgb(var(--color-primary) / 0.5);
  --card-progress: #{$progress-color};
}

// ============================================================================
// TOOLS - Mixins and Functions
// ============================================================================

@mixin card-transition {
  @apply transition-all duration-300 ease-out;
}

@mixin card-focus-ring {
  &:focus-visible {
    @apply outline-none;
    box-shadow:
      0 0 0 2px var(--card-focus-ring),
      0 0 0 4px var(--card-focus-offset);
  }
}

@mixin card-hover-effect {
  &:hover:not(.project-card--disabled) {
    @apply transform scale-105 -translate-y-2;
    box-shadow: 0 12px 32px rgba(0, 0, 0, 0.12);
    cursor: pointer;

    .project-card__image {
      @apply transform scale-110;
    }

    .project-card__title {
      color: var(--card-primary);
    }

    .project-card__buttons .btn {
      @apply transform scale-105;
    }
  }
}

@mixin image-transition {
  transition: transform $image-transition-duration $card-easing;
}

@mixin text-clamp($lines: 3) {
  display: -webkit-box;
  -webkit-line-clamp: $lines;
  -webkit-box-orient: vertical;
  overflow: hidden;
  text-overflow: ellipsis;
  word-break: break-word;
}

// ============================================================================
// COMPONENTS - Project Card
// ============================================================================

.project-card {
  @include card-transition;
  @include card-focus-ring;
  @include card-hover-effect;

  @apply relative overflow-hidden cursor-default flex flex-col;
  background-color: var(--card-bg);
  border: 1px solid var(--card-border);
  border-radius: $card-border-radius;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
  height: 100%; // Garante que todos os cards tenham a mesma altura

  // Progress Badge
  &__progress-badge {
    @apply absolute top-3 right-3 z-20 flex items-center gap-1.5 px-3 py-1.5 rounded-full text-xs font-semibold;
    background: $progress-color-strong;
    backdrop-filter: blur(8px);
    color: white;
    box-shadow: 0 2px 8px $progress-color-medium;
    border: 1px solid rgba(255, 255, 255, 0.2);

    svg {
      animation: spin 2s linear infinite;
    }
  }

  // Image structure
  &__image-container {
    @apply relative overflow-hidden;
    height: $card-image-height;
  }

  &__image {
    @include image-transition;
    @apply w-full h-full object-cover;
  }

  &__image-overlay {
    @apply absolute inset-0;
    background: linear-gradient(
      to bottom,
      transparent 0%,
      rgba(0, 0, 0, 0.05) 70%,
      rgba(0, 0, 0, 0.15) 100%
    );
  }

  // Progress Overlay
  &__progress-overlay {
    @apply absolute inset-0 z-10 flex items-center justify-center;
    background: rgba(0, 0, 0, 0.4);
    backdrop-filter: blur(2px);
    opacity: 0;
    transition: opacity 0.3s ease;
  }

  &__progress-indicator {
    @apply flex items-center justify-center w-16 h-16 rounded-full;
    background: $progress-color-strong;
    color: white;
    box-shadow: 0 4px 16px $progress-color-medium;

    svg {
      animation: spin 2s linear infinite;
    }
  }

  // Content area
  &__content {
    @apply relative flex flex-col flex-1 min-h-0;
    @apply pr-8 pb-8 pl-8 pt-3; // 32px nas laterais e bottom, 12px no top
  }

  &__title {
    @include card-transition;
    @apply mb-2 font-semibold text-xl leading-tight;
    color: var(--card-text);
    min-height: 3rem; // Altura mínima para títulos (2 linhas)
    max-height: 5rem; // Altura máxima para títulos (permite mais espaço)
    display: -webkit-box;
    -webkit-line-clamp: 3; // Permite até 3 linhas
    -webkit-box-orient: vertical;
    overflow: hidden;
    flex-shrink: 0; // Não encolhe
    line-height: 1.5; // Aumenta o line-height para melhor espaçamento
    margin: 0; // Remove todas as margens (incluindo margin padrão do h3)
  }

  &__subtitle {
    @apply mb-3 text-xs font-semibold uppercase tracking-wider;
    color: rgb(var(--color-primary) / 0.8);
    text-align: center;
    flex-shrink: 0; // Não encolhe
    min-height: 1.25rem; // Altura mínima
    letter-spacing: 0.05em;
    opacity: 0.9;
  }

  &__description {
    @apply mb-6 text-base leading-relaxed;
    color: var(--card-text-muted);
    flex-shrink: 0; // Não encolhe
    line-height: 1.5; // Altura da linha para cálculo correto
    word-wrap: break-word; // Quebra palavras longas
    overflow-wrap: break-word; // Quebra palavras longas
  }

  &__tags {
    @apply flex flex-wrap gap-2 mb-6;
    flex-shrink: 0; // Não encolhe
    min-height: fit-content;
  }

  &__buttons {
    @apply flex gap-3;
    margin-top: auto; // Empurra os botões para o final
    flex-shrink: 0; // Não encolhe

    .btn {
      @include card-transition;
      @apply flex-1 flex items-center justify-center gap-2;

      &:hover:not(:disabled) {
        @apply cursor-pointer;
      }

      &:disabled,
      &.btn--disabled {
        @apply cursor-not-allowed opacity-50;
        pointer-events: none;
      }
    }

    // Override para botão em progresso
    .project-card__button--full-width {
      @apply w-full min-w-full max-w-full;
      flex: none;
    }

    // Botão privado - estilo especial para indicar que não é clicável
    .project-card__button--private {
      @apply opacity-50 cursor-not-allowed;
      pointer-events: none;
      
      &:hover {
        @apply opacity-50 cursor-not-allowed;
        @apply transform-none;
        @apply shadow-none;
      }
    }

    // Botão em progresso - estilo com paleta amarela
    .project-card__button--progress {
      border-color: $progress-color-medium;
      color: $progress-color;
      
      &:hover:not(:disabled) {
        background-color: $progress-color-medium;
        color: rgb(var(--color-text));
        border-color: $progress-color;
      }

      &:disabled {
        border-color: $progress-color-medium;
        color: $progress-color;
        opacity: 0.7;
      }
    }

    // Container quando há apenas um botão (em progresso)
    &--single {
      @apply gap-0 w-full flex justify-stretch items-stretch;

      // Container do botão também precisa ocupar 100%
      .btn-container {
        @apply w-full min-w-full max-w-full;
        flex: 1 1 100%;
      }

      .btn {
        @apply w-full min-w-full max-w-full;
        flex: 1 1 100%;
      }
    }
  }

  // Card states
  &--loading {
    @apply relative overflow-hidden;

    &::after {
      content: '';
      @apply absolute inset-0;
      background: linear-gradient(
        90deg,
        transparent,
        rgba(255, 255, 255, 0.8),
        transparent
      );
      animation: shimmer $shimmer-duration infinite;
    }
  }

  &--disabled {
    @apply opacity-50 pointer-events-none;
  }

  &--elevated {
    box-shadow: 0 12px 32px rgba(0, 0, 0, 0.12);
  }

  // Progress card variant
  &--progress {
    border-color: $progress-color-medium;
    background: linear-gradient(135deg, $progress-color-light, var(--card-bg));

    .project-card__title {
      position: relative;

      &::after {
        content: '';
        position: absolute;
        bottom: -4px;
        left: 0;
        width: 100%;
        height: 2px;
        background: linear-gradient(
          90deg,
          transparent 0%,
          $progress-color 50%,
          transparent 100%
        );
        animation: progressBar 3s ease-in-out infinite;
      }
    }

    // Tags com paleta amarela
    .project-card__tags {
      .tag {
        border-color: $progress-color-medium;
        color: $progress-color;
        background-color: $progress-color-light;
      }
    }

    &:hover {
      .project-card__title {
        color: var(--card-progress);
      }

      .project-card__progress-overlay {
        opacity: 1;
      }
    }
  }

  // Color variants using your custom theme colors
  &--primary {
    border-color: rgb(var(--color-primary) / 0.2);
    background: linear-gradient(
      135deg,
      rgb(var(--color-primary) / 0.03),
      var(--card-bg)
    );

    &:hover .project-card__title {
      color: var(--card-primary);
    }
  }

  &--accent {
    border-color: rgb(var(--color-accent) / 0.2);
    background: linear-gradient(
      135deg,
      rgb(var(--color-accent) / 0.03),
      var(--card-bg)
    );

    &:hover .project-card__title {
      color: var(--card-accent);
    }
  }

  // Size variants
  &--compact {
    .project-card__content {
      padding: $card-content-padding-compact;
    }

    .project-card__image-container {
      height: $card-image-height-compact;
    }

    .project-card__title {
      @apply text-lg mb-2;
      min-height: 2.5rem;
      max-height: 2.5rem;
    }

    .project-card__description {
      @apply mb-4 text-sm;
      min-height: 3.5rem;
      max-height: 3.5rem;
    }

    .project-card__buttons {
      @apply gap-2;

      .btn {
        @apply px-3 py-1.5 text-xs;
      }
    }

    .project-card__progress-badge {
      @apply text-xs px-2 py-1;

      svg {
        width: 10px;
        height: 10px;
      }
    }
  }

  &--large {
    .project-card__content {
      padding: $card-content-padding-large;
    }

    .project-card__image-container {
      height: $card-image-height-large;
    }

    .project-card__title {
      @apply text-2xl mb-4;
      min-height: 3.5rem;
      max-height: 3.5rem;
    }

    .project-card__description {
      @apply mb-8 text-lg;
      min-height: 5.5rem;
      max-height: 5.5rem;
    }

    .project-card__progress-badge {
      @apply text-sm px-4 py-2;

      svg {
        width: 14px;
        height: 14px;
      }
    }
  }
}

// ============================================================================
// COMPONENTS - Project Grid
// ============================================================================

.project-grid {
  @apply grid w-full;
  gap: 1.5rem; // Default medium gap
  align-items: stretch; // Garante que todos os cards tenham a mesma altura

  // Column system - responsive optimized
  &--1 {
    @apply grid-cols-1;
  }

  &--2 {
    @apply grid-cols-1 md:grid-cols-2;
  }

  &--3 {
    @apply grid-cols-1 md:grid-cols-2 lg:grid-cols-3;
  }

  &--4 {
    @apply grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4;
  }

  // Custom responsive system
  &--responsive {
    @apply grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4;
  }

  // Garante que os cards dentro do grid tenham altura uniforme
  .project-card {
    height: 100%;
    display: flex;
    flex-direction: column;
  }

  // Gap variations
  &--gap-small {
    gap: 1rem;
  }

  &--gap-large {
    gap: 2rem;
  }

  // Empty state
  &__empty {
    @apply flex flex-col items-center justify-center p-16 text-center;
    min-height: 12.5rem;

    &-text {
      @apply text-base;
      color: var(--card-text-subtle);
    }
  }

  // Loading state
  &--loading .project-card {
    animation: pulse $pulse-duration cubic-bezier(0.4, 0, 0.6, 1) infinite;
  }

  // Initial load animation
  &--initial-load {
    .project-card {
      animation: cardFadeIn 0.6s ease-out backwards;

      // Staggered delay for each card
      @for $i from 1 through 12 {
        &:nth-child(#{$i}) {
          animation-delay: #{$i * 0.1}s;
        }
      }
    }
  }

  // Filter change animation
  &--filter-change {
    .project-card {
      animation: cardSlideIn 0.4s ease-out;

      @for $i from 1 through 12 {
        &:nth-child(#{$i}) {
          animation-delay: #{$i * 0.05}s;
        }
      }
    }
  }
}

// ============================================================================
// UTILITIES - Animations
// ============================================================================

@keyframes spin {
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(360deg);
  }
}

@keyframes progressBar {
  0%,
  100% {
    transform: translateX(-100%);
    opacity: 0;
  }
  50% {
    transform: translateX(0%);
    opacity: 1;
  }
}

@keyframes shimmer {
  from {
    transform: translateX(-100%);
  }
  to {
    transform: translateX(100%);
  }
}

@keyframes pulse {
  0%,
  100% {
    opacity: 1;
  }
  50% {
    opacity: 0.5;
  }
}

@keyframes cardFadeIn {
  from {
    opacity: 0;
    transform: translateY(20px) scale(0.95);
  }
  to {
    opacity: 1;
    transform: translateY(0) scale(1);
  }
}

@keyframes cardSlideIn {
  from {
    opacity: 0;
    transform: translateY(10px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

// ============================================================================
// UTILITIES - Cursor Control
// ============================================================================

.project-grid .project-card {
  @apply cursor-pointer;

  * {
    cursor: inherit;
  }

  // Clickable elements
  .project-card__buttons .btn,
  a,
  button,
  [role='button'],
  [data-clickable='true'] {
    @apply cursor-pointer;

    &:hover {
      @apply cursor-pointer;
    }

    &:disabled,
    &.disabled {
      @apply cursor-not-allowed;
    }
  }

  // Non-clickable elements inside clickable card
  .project-card__title,
  .project-card__description,
  .project-card__image,
  .project-card__tags,
  .project-card__content {
    @apply cursor-pointer;
  }

  // Disabled state
  &--disabled {
    @apply cursor-not-allowed;
  }
}

// ============================================================================
// UTILITIES - Responsive Adjustments
// ============================================================================

// Mobile specific adjustments (max 640px)
@media (max-width: 640px) {
  .project-card {
    &__content {
      padding: $card-content-padding-compact;
    }

    &__title {
      @apply text-lg;
    }

    &__description {
      @include text-clamp(2);
      @apply text-sm;
    }

    &__buttons {
      @apply flex-col gap-2;

      .btn {
        @apply w-full;
      }
    }

    &__progress-badge {
      @apply text-xs px-2 py-1 top-2 right-2;
    }
  }

  .project-grid {
    gap: 1rem;

    &--gap-large {
      gap: 1.5rem;
    }
  }
}

// Tablet adjustments (768px - 1023px)
@media (min-width: 768px) and (max-width: 1023px) {
  .project-grid--responsive {
    .project-card {
      &__buttons {
        @apply flex-row;

        .btn {
          @apply min-w-0 flex-1;
        }
      }
    }
  }
}

// Large desktop adjustments (1920px+)
@media (min-width: 1920px) {
  .project-card {
    &__content {
      padding: $card-content-padding-large;
    }

    &__title {
      @apply text-2xl;
    }

    &__description {
      @apply text-lg;
    }
  }

  .project-grid {
    gap: 2rem;

    &--gap-small {
      gap: 1.5rem;
    }
  }
}

// ============================================================================
// UTILITIES - Dark Theme Adjustments
// ============================================================================

.dark {
  .project-card {
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.25);

    &--elevated {
      box-shadow: 0 12px 32px rgba(0, 0, 0, 0.35);
    }

    &:hover:not(.project-card--disabled) {
      box-shadow: 0 12px 32px rgba(0, 0, 0, 0.35);
    }

    &--loading::after {
      background: linear-gradient(
        90deg,
        transparent,
        rgb(var(--color-surface) / 0.8),
        transparent
      );
    }

    // Progress badge adjustment for dark theme
    &__progress-badge {
      background: rgba(255, 165, 0, 0.95);
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    &__progress-indicator {
      background: rgba(255, 165, 0, 0.95);
    }
  }
}
