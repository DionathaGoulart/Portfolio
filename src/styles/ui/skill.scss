@use 'sass:map';

// ============================================================================
// SETTINGS - DESIGN TOKENS
// ============================================================================

:root {
  --skill-animation-duration: 1.5s;
  --skill-animation-easing: cubic-bezier(0.4, 0, 0.2, 1);
  --skill-bar-height: 0.5rem;
  --skill-bar-radius: 0.25rem;
}

// Design system tokens para skills
$skill-tokens: (
  'animation-duration': 1.5s,
  'animation-easing': cubic-bezier(0.4, 0, 0.2, 1),
  'bar-height': (
    'small': 0.375rem,
    'medium': 0.5rem,
    'large': 0.75rem
  ),
  'bar-radius': 0.25rem,
  'gaps': (
    'small': 0.5rem,
    'medium': 0.75rem,
    'large': 1rem
  )
);

// ============================================================================
// TOOLS - MIXINS
// ============================================================================

/**
 * Mixin para responsividade mobile-first
 * @param {string} $breakpoint - Breakpoint desejado
 */
@mixin respond-above($breakpoint) {
  @if $breakpoint == 'sm' {
    @media (min-width: 640px) {
      @content;
    }
  }
  @if $breakpoint == 'md' {
    @media (min-width: 768px) {
      @content;
    }
  }
  @if $breakpoint == 'lg' {
    @media (min-width: 1024px) {
      @content;
    }
  }
  @if $breakpoint == 'xl' {
    @media (min-width: 1280px) {
      @content;
    }
  }
  @if $breakpoint == '2xl' {
    @media (min-width: 1536px) {
      @content;
    }
  }
}

/**
 * Mixin para animação de entrada com delay
 */
@mixin skill-entrance-animation {
  opacity: 0;
  transform: translateY(20px);
  animation: skillFadeIn 0.6s ease-out forwards;
  animation-delay: var(--animation-delay, 0ms);
}

/**
 * Mixin para barra de progresso com gradiente
 */
@mixin skill-progress-bar {
  height: 100%;
  background: linear-gradient(
    90deg,
    rgb(var(--color-primary)),
    rgb(var(--color-primary) / 0.8)
  );
  border-radius: var(--skill-bar-radius);
  width: var(--skill-percentage, 0%);
  transition: width var(--skill-animation-duration)
    var(--skill-animation-easing);
  position: relative;

  &::after {
    content: '';
    @apply absolute top-0 left-0 w-full h-full;
    left: -100%;
    background: linear-gradient(
      90deg,
      transparent,
      rgba(255, 255, 255, 0.4),
      transparent
    );
    animation: skillShine 2s ease-in-out 1s;
  }
}

// ============================================================================
// BASE - SKILL BAR COMPONENT
// ============================================================================

.skill-bar {
  @apply flex flex-col;
  gap: map.get($skill-tokens, 'gaps', 'medium');
  @include skill-entrance-animation;

  &__header {
    @apply flex justify-between items-center mb-2;

    @media (max-width: 640px) {
      @apply flex-col items-start gap-1;
    }
  }

  &__name {
    @apply font-semibold text-base m-0;
    color: rgb(var(--color-text));

    @media (max-width: 640px) {
      @apply text-sm;
    }
  }

  &__percentage {
    @apply font-bold text-sm m-0 min-w-12 text-right;
    color: rgb(var(--color-primary));
    font-variant-numeric: tabular-nums;

    @media (max-width: 640px) {
      @apply text-xs min-w-0 self-end;
    }
  }

  &__track {
    @apply w-full rounded overflow-hidden relative;
    background-color: rgb(var(--color-border));
    height: var(--skill-bar-height);
    border-radius: var(--skill-bar-radius);
  }

  &__fill {
    @include skill-progress-bar;
  }

  // Estado sem animação
  &:not(.skill-bar--animated) {
    @apply opacity-100 transform-none;
    animation: none;

    .skill-bar__fill {
      transition: none;

      &::after {
        display: none;
      }
    }
  }
}

// ============================================================================
// COMPONENTS - SIZE VARIANTS
// ============================================================================

.skill-bar {
  &--small {
    gap: map.get($skill-tokens, 'gaps', 'small');

    .skill-bar__name {
      @apply text-sm;
    }

    .skill-bar__percentage {
      @apply text-xs;
    }

    .skill-bar__track {
      --skill-bar-height: #{map.get($skill-tokens, 'bar-height', 'small')};
    }
  }

  &--large {
    gap: map.get($skill-tokens, 'gaps', 'large');

    .skill-bar__name {
      @apply text-lg;
    }

    .skill-bar__percentage {
      @apply text-base;
    }

    .skill-bar__track {
      --skill-bar-height: #{map.get($skill-tokens, 'bar-height', 'large')};
    }

    @include respond-above('2xl') {
      @apply gap-5;

      .skill-bar__name {
        @apply text-xl;
      }

      .skill-bar__percentage {
        @apply text-lg;
      }
    }
  }
}

// ============================================================================
// COMPONENTS - STYLE VARIANTS
// ============================================================================

.skill-bar {
  &--minimal {
    gap: map.get($skill-tokens, 'gaps', 'small');

    .skill-bar__header {
      @apply mb-1;
    }

    .skill-bar__track {
      --skill-bar-height: 0.25rem;
    }
  }

  &--detailed {
    @apply p-4 border rounded-lg shadow-sm transition-all duration-300;
    background-color: rgb(var(--color-surface));
    border-color: rgb(var(--color-border));

    &:hover {
      @apply shadow-md -translate-y-0.5;
    }

    @include respond-above('sm') {
      @media (max-width: 1023px) {
        @apply p-3;
      }
    }
  }
}

// ============================================================================
// COMPONENTS - SKILL GRID SYSTEM
// ============================================================================

.skill-category {
  &:not(:last-child) {
    @apply mb-8;
  }

  &__title {
    @apply text-xl font-semibold mb-6 pb-2 inline-block;
    color: rgb(var(--color-text));
    border-bottom: 2px solid rgb(var(--color-primary) / 0.2);

    @media (max-width: 640px) {
      @apply text-lg mb-4;
    }
  }
}

.skill-grid {
  @apply grid w-full gap-6;

  // Sistema de colunas responsivo
  &--1 {
    @apply grid-cols-1;
  }

  &--2 {
    @apply grid-cols-1;

    @include respond-above('sm') {
      @apply grid-cols-2;
    }
  }

  &--3,
  &--responsive {
    @apply grid-cols-1;

    @include respond-above('sm') {
      @apply grid-cols-2;
    }

    @include respond-above('lg') {
      @apply grid-cols-3;
    }
  }

  // Variações de gap
  &--gap-small {
    @apply gap-4;
  }

  &--gap-large {
    @apply gap-8;

    @include respond-above('2xl') {
      @apply gap-6;
    }
  }

  // Responsividade global do grid
  @media (max-width: 640px) {
    @apply gap-4;
  }

  @include respond-above('2xl') {
    @apply gap-8;
  }
}

// ============================================================================
// UTILITIES - ANIMATIONS
// ============================================================================

@keyframes skillFadeIn {
  to {
    @apply opacity-100 translate-y-0;
  }
}

@keyframes skillShine {
  0% {
    left: -100%;
  }
  50% {
    left: 0%;
  }
  100% {
    left: 100%;
  }
}

// ============================================================================
// UTILITIES - SINGLE COLOR SYSTEM
// ============================================================================

.skill-bar {
  // Todas as skills usam apenas a cor primary padrão do design system
  .skill-bar__fill {
    background: linear-gradient(
      90deg,
      rgb(var(--color-primary)),
      rgb(var(--color-primary) / 0.8)
    );
  }
}
