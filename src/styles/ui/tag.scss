@use 'sass:map';
@use 'sass:list';

// ================================
// SETTINGS - DESIGN TOKENS
// ================================

$tag-colors: (
  primary: var(--color-primary),
  secondary: var(--color-secondary),
  accent: var(--color-accent),
  text: var(--color-text),
  textSecondary: var(--color-textSecondary),
  error: var(--color-error),
  success: var(--color-success),
  warning: var(--color-warning)
);

$tag-variants: solid, outline, ghost;
$tag-sizes: small, medium, large;

$status-colors: (
  online: success,
  offline: error,
  pending: warning
);

// ================================
// TOOLS - MIXINS
// ================================

@mixin tag-base {
  @apply inline-flex items-center justify-center font-medium rounded-full;
  @apply transform transition-all duration-200 ease-in-out;

  &:focus-visible {
    outline: none;
    box-shadow:
      0 0 0 2px rgb(var(--color-background)),
      0 0 0 4px rgb(var(--color-primary) / 0.5);
  }
}

@mixin tag-variant($variant, $color) {
  $color-value: map.get($tag-colors, $color);

  @if $variant == solid {
    background-color: rgb(#{$color-value});
    color: rgb(var(--color-text));
    border: 1px solid rgb(#{$color-value});

    @if $color == text {
      background-color: rgb(var(--color-text));
      color: rgb(var(--color-background));
    } @else if $color == textSecondary {
      background-color: rgb(var(--color-textSecondary));
      color: rgb(var(--color-text));
    }

    &.tag--interactive:hover:not(.tag--disabled) {
      background-color: rgb(#{$color-value} / 0.8);
    }
  } @else if $variant == outline {
    @apply bg-transparent;
    border: 1px solid rgb(#{$color-value});
    color: rgb(#{$color-value});

    &.tag--interactive:hover:not(.tag--disabled) {
      background-color: rgb(#{$color-value} / 0.1);
    }
  } @else if $variant == ghost {
    background-color: rgb(#{$color-value} / 0.1);
    @apply border border-transparent;
    color: rgb(#{$color-value});

    &.tag--interactive:hover:not(.tag--disabled) {
      background-color: rgb(#{$color-value} / 0.2);
    }
  }
}

@mixin tag-size($size) {
  @if $size == small {
    @apply text-xs px-2 py-0.5;
  } @else if $size == medium {
    @apply text-sm px-3 py-1;
  } @else if $size == large {
    @apply text-base px-4 py-1.5;
  }
}

// ================================
// BASE - TAG FOUNDATION
// ================================

.tag {
  @include tag-base;

  // States
  &--interactive {
    @apply cursor-pointer;

    &:hover:not(.tag--disabled) {
      transform: scale(1.05);
    }
  }

  &--disabled {
    @apply opacity-50 cursor-not-allowed;

    &:hover {
      transform: none;
    }
  }
}

// ================================
// COMPONENTS - SIZE VARIANTS
// ================================

@each $size in $tag-sizes {
  .tag--#{$size} {
    @include tag-size($size);
  }
}

// ================================
// COMPONENTS - COLOR + VARIANT COMBINATIONS
// ================================

@each $color in map.keys($tag-colors) {
  @each $variant in $tag-variants {
    .tag--#{$variant}-#{$color} {
      @include tag-variant($variant, $color);
    }
  }
}

// ================================
// COMPONENTS - FEATURE MODIFIERS
// ================================

.tag {
  // Icon feature
  &--with-icon {
    @apply gap-1;

    &__icon {
      @apply flex-shrink-0;
    }
  }

  // Removable feature
  &--removable {
    @apply pr-1;

    &__remove-btn {
      @apply ml-1 rounded-full p-0.5 transition-colors;
      @apply hover:bg-black hover:bg-opacity-10;

      &-icon {
        @apply w-3 h-3;
      }
    }
  }

  // Badge feature
  &--with-badge {
    @apply relative;

    &__badge {
      @apply absolute -top-1 -right-1 min-w-4 h-4;
      @apply flex items-center justify-center text-xs rounded-full;
      @apply bg-red-500 text-white px-1;
    }
  }
}

// ================================
// COMPONENTS - ICON SIZING BY TAG SIZE
// ================================

.tag--small.tag--with-icon .tag__icon {
  @apply w-2.5 h-2.5;
}

.tag--medium.tag--with-icon .tag__icon {
  @apply w-3 h-3;
}

.tag--large.tag--with-icon .tag__icon {
  @apply w-4 h-4;
}

// ================================
// COMPONENTS - STATUS TAGS
// ================================

@each $status, $color in $status-colors {
  $color-value: map.get($tag-colors, $color);

  .tag--status-#{$status} {
    @apply text-xs px-2 py-0.5 relative;
    background-color: rgb(#{$color-value} / 0.1);
    color: rgb(#{$color-value});

    &::before {
      content: '';
      @apply w-2 h-2 rounded-full mr-1;
      background-color: rgb(#{$color-value});
    }
  }
}

// ================================
// COMPONENTS - CONTAINERS
// ================================

.tag-group {
  @apply flex flex-wrap gap-2;

  &--compact {
    @apply gap-1;
  }
}
